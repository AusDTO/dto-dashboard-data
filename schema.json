{
  "$schema": "http://json-schema.org/draft-04/schema#",
  "description": "Draft Format for describing data for dashboards",
  "name": "Dashboard Data",
  "definitions": {
    "recorded_at": {
      "type": "string",
      "format": "date-time",
      "name": "recorded_at",
      "description": "The datetime the measurement was recorded. JSON datetime format (YY-MM-DDTHH:MM:SS.sssZ)."
    },
    "tags": {
      "type": "array",
      "name": "tags",
      "description": "An array of arbitrary tags.",
      "items": {
        "type": "string"
      }
    },
    "type": {
      "type": "string",
      "name": "type",
      "description": "The type of chart to display.",
      "enum": ["bar", "line"]
    },
    "bar": {
      "type": "object",
      "name": "Bar",
      "description": "Data format for bar chart",
      "minProperties": 1,
      "properties": {
        "label": { "type": "string" },
        "value": { "type": "string" }
      },
      "required": ["label", "value"]
    },
    "lineValue": {
      "type": "object",
      "name": "Line Value",
      "properties": {
        "x": {
          "oneOf": [
            { "type": "string" },
            { "type": "number" }
          ]
        },
        "y": { "type": "number" }
      },
      "required": ["x", "y"]
    },
    "line": {
      "type": "object",
      "name": "Line",
      "description": "Data format for line chart",
      "minProperties": 1,
      "properties": {
        "key": { "type": "string" },
        "values": {
          "type": "array",
          "items": { "$ref": "#/definitions/lineValue" }
        }
      },
      "required": ["key", "values"]
    },
    "benchmark": {
      "type": "object",
      "name": "Benchmark",
      "description": "A benchmark for referencing",
      "minProperties": 1,
      "properties": {
        "value": { "type": "string" },
        "effective_at": {
          "type": "string",
          "format": "date-time"
        }
      },
      "required": ["key", "values"]
    },
    "metric": {
      "type": "object",
      "name": "metric",
      "properties": {
        "name":         { "type": "string" },
        "description":  { "type": "string" },
        "recorded_at":  { "$ref": "#/definitions/recorded_at" },
        "period":       { "type": "string", "enum": ["daily", "weekly", "monthly"]},
        "tags":         { "$ref": "#/definitions/tags" },
        "type":         { "$ref": "#/definitions/type" },
        "data":         {
          "type": "array",
          "items": {
            "oneOf": [
              { "$ref": "#/definitions/bar" },
              { "$ref": "#/definitions/line" }
            ]
          }
        }
      },
      "required": ["name", "recorded_at", "type",  "data"]
    }
  },
  "properties": {
    "version": {
      "type": "string",
      "description": "The version of the dashboard schema to be used",
      "enum": ["1"]
    },
    "updated_at": {
      "type": "string",
      "format": "date-time",
      "description": "The datetime the document was updated. JSON datetime format (YY-MM-DDTHH:MM:SS.sssZ).",
      "name": "updated_at"
    },
    "agency": {
      "type": "string",
      "description": "The name of the agency who owns the data.",
      "name": "agency"
    },
    "service": {
      "type": "string",
      "description": "The name of the service",
      "name": "Service"
    },
    "interaction": {
      "type": "string",
      "description": "The name of the interacton this data applies to.",
      "name": "agency"
    },
    "metrics": {
      "type": "array",
      "description": "An array of service metrics.",
      "name": "metric",
      "items": {
        "oneOf": [
          { "$ref": "#/definitions/metric" }
        ]
      }
    }
  },
  "required": [
    "version",
    "updated_at",
    "name",
    "url",
    "agency",
    "service",
    "interaction",
    "activity",
    "metrics"
  ]
}
